{% extends "layout.html" %}
{% block title %}Grade Reports{% endblock %}
{% block content %}
<div style="border:2px solid #004080;padding:18px;border-radius:12px;max-width:900px;margin:auto;background:#f9fbff;">
  {% if selected_grade %}
    <div style="text-align:center;margin-bottom:18px;">
      <a href="{{ url_for('grade_reports_pdf', grade=selected_grade, term=selected_term, exam_type=selected_exam_type) }}" class="btn" target="_blank">Export All as PDF</a>
      <a href="{{ url_for('grade_reports_word', grade=selected_grade, term=selected_term, exam_type=selected_exam_type) }}" class="btn" target="_blank">Export All as Word</a>
    </div>
  {% endif %}
  <form method="get" style="margin-bottom:18px;display:flex;gap:18px;flex-wrap:wrap;align-items:center;justify-content:center;">
    <label for="grade">Grade:</label>
    <select name="grade" id="grade" onchange="this.form.submit()">
      <option value="">Select Grade</option>
      {% for g in grades %}
        <option value="{{ g }}" {% if selected_grade==g %}selected{% endif %}>{{ g }}</option>
      {% endfor %}
    </select>
    <label for="term">Term:</label>
    <select name="term" id="term" onchange="this.form.submit()">
      <option value="">Select Term</option>
      {% for t in terms %}
        <option value="{{ t }}" {% if selected_term==t %}selected{% endif %}>{{ t }}</option>
      {% endfor %}
    </select>
    <label for="exam_type">Exam Type:</label>
    <select name="exam_type" id="exam_type" onchange="this.form.submit()">
      <option value="">Select Exam Type</option>
      {% for e in exam_types %}
        <option value="{{ e }}" {% if selected_exam_type==e %}selected{% endif %}>{{ e }}</option>
      {% endfor %}
    </select>
  </form>
  <h3 style="text-align:center;background:#e6f0ff;padding:8px 0;border-radius:8px;letter-spacing:1px;">
    2025
    {% if selected_term %} {{ selected_term|upper }}{% endif %}
    {% if selected_exam_type %} {{ selected_exam_type|upper }}{% endif %}
    GRADE REPORTS
  </h3>
  {% if learners %}
  <table>
    <thead>
      <tr style="background:#e6f0ff;">
        <th>Name</th>
        <th>Grade</th>
        <th>Average Score</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for learner in learners %}
      <tr>
        <td>{{ learner.full_name }}</td>
        <td>{{ learner.grade }}</td>
        <td>{{ '%.2f'|format(learner.average_score or 0) }}</td>
        <td>
          <a href="{{ url_for('view_learner', learner_id=learner.id, term=selected_term, exam_type=selected_exam_type, grade=selected_grade) }}" target="_blank">View</a>
          <a href="{{ url_for('report_pdf', learner_id=learner.id, term=selected_term, exam_type=selected_exam_type, grade=selected_grade) }}" target="_blank">PDF</a>
          <a href="{{ url_for('export_word.report_word', learner_id=learner.id, term=selected_term, exam_type=selected_exam_type, grade=selected_grade) }}" target="_blank">Word</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No learners found for the selected filters.</p>
  {% endif %}
</div>
{% endblock %}
